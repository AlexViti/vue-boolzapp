<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Favicon -->
	<link rel="shortcut icon" href="img/favicon/favicon-64x64.ico" type="image/x-icon">

	<title>Boolzapp</title>

	<!-- Lato, Google Font  -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<!-- CSS stylesheet -->
	<link rel="stylesheet" href="css/style.css">
</head>

<body>

	<!-- Vue app container -->
	<div id="root" class="wrapper">

		<!-- Container with a header, a banner and a chats list with a search-bar -->
		<div class="left-container">

			<!-- Header with user's profile and buttons -->
			<header class="flex-align-center">

				<div class="user flex-align-center">
					<!-- User's avatar -->
					<img :src="myUser.avatar" :alt="myUser.name" class="avatar">
					<!-- User's name -->
					<div class="username">Alessio</div>
				</div>
				<!-- Buttons on the right -->
				<div class="btns">
					<button class="btn"><i class="fa-solid fa-circle-notch"></i></button>
					<button class="btn"><i class="fa-solid fa-message"></i></button>
					<button class="btn"><i class="fa-solid fa-ellipsis-vertical"></i></button>
				</div>

			</header>

			<!-- Banner asking you to turn on notification -->
			<div class="notification flex-align-center">
				<div class="notification-bell"><i class="fa-solid fa-bell-slash"></i></div>
				<div>
					<div>Ricevi notifiche di nuovi messaggi</div>
					<a href="#">Attiva notifiche desktop</a>
				</div>
			</div>

			<!-- Search-bar for chats with a text input and a button -->
			<div class="search-bar flex-align-center">
				<label for="search-input" class="search-label"><i class="fa-solid fa-magnifying-glass"></i></label>
				<input v-model="searchChat" type="text" id="search-input" placeholder="Cerca o inizia una nuova chat">
			</div>

			<!-- Chats container -->
			<div class="chats-wrapper">
				<div v-for="element in displayedChats()"
					@click="currentId = element.id" 
					class="chat flex-align-center" :class="{selected : element.id == currentId}">
					
					<img :src="element.user.avatar" :alt="element.user.name" class="avatar">
					<div>
						<div class="username">{{ element.user.name }}</div>
						<div class="last-msg">{{ element.messages[element.messages.length - 1].text }}</div>
					</div>
					<div class="date">{{ toRelative(element.messages[element.messages.length - 1].date) }}</div>
				</div>
			</div>
		</div>

		<!-- Container with an header with interlocutor infos, the chat display and a footer with new message input -->
		<div class="right-container">

			<!-- Interlocutor infos -->
			<header class="flex-align-center">
				<div class="user flex-align-center">
					<img :src="idFinder(currentId).user.avatar" :alt="idFinder(currentId).user.name" class="avatar">
					<div>
						<div class="username">{{ idFinder(currentId).user.name }}</div>
						<div class="last-access">Ultimo accesso {{ toRelative(idFinder(currentId).lastAccess) }}</div>
					</div>
				</div>

				<!-- Utility buttons on the right -->
				<div class="btns">
					<button class="btn"><i class="fa-solid fa-magnifying-glass"></i></button>
					<button class="btn"><i class="fa-solid fa-paperclip"></i></button>
					<button class="btn"><i class="fa-solid fa-ellipsis-vertical"></i></button>
				</div>
			</header>

			<div class="chat-display">
				<div v-for="element in idFinder(currentId).messages" class="message" :class="element.sent ? 'my-message' : 'received-message'">
					<div class="text">{{ element.text }}</div>
					<div class="date">{{ toRelative(element.date) }}</div>
				</div>
			</div>

			<footer class="new-message flex-align-center">
				<button class="btn"><i class="fa-regular fa-face-smile"></i></button>
				<input @keyup.enter="newMessage" v-model="newMessageText" type="text" name="new-message" id="new-message-input" placeholder="Scrivi un messaggio">
				<button v-if="newMessageText.trim() == ''" class="btn fix-width"><i class="fa-solid fa-microphone"></i></button>
				<button @click="newMessage" v-else class="btn fix-width"><img src="img/paper-plane-top.png" alt=""></button>
			</footer>
		</div>
	</div>

	<!-- SCRIPTS -->
	<!-- Luxon date library -->
	<script src="https://cdn.jsdelivr.net/npm/luxon@2.3.1/build/global/luxon.min.js"></script>
	<!-- VUE CDN: development version, includes helpful console warnings -->
	<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
	<!-- My script -->
	<script src="js/script.js"></script>
</body>
</html>